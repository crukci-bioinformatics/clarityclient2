<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M10 from src/site/markdown/filestore.md at 2024-10-23
 | Rendered using Apache Maven Fluido Skin 2.0.0-M6
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M10" />
    <title>CRUK-CI Clarity API Client – File Store Access</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.0.0-M6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.0.0-M6.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2024-10-23<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.31.0</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">User Guide</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="installing.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="usageoverview.html" title="Usage"><span class="icon-chevron-down"></span>Usage</a>
     <ul class="nav nav-list">
      <li><a href="spring.html" title="Spring Configuration"><span class="none"></span>Spring Configuration</a></li>
      <li><a href="usage.html" title="Basic Usage"><span class="none"></span>Basic Usage</a></li>
      <li><a href="caching.html" title="Caching"><span class="none"></span>Caching</a></li>
      <li><a href="serverside.html" title="Server Deployment"><span class="none"></span>Server Deployment</a></li>
      <li><a href="automation.html" title="Process Automation"><span class="none"></span>Process Automation</a></li>
      <li><a href="usage_recorder.html" title="Recording and Playback"><span class="none"></span>Recording and Playback</a></li>
     </ul></li>
    <li class="active"><a><span class="none"></span>SFTP File Store Access</a></li>
    <li><a href="commons-beanutils.html" title="commons-beanutils"><span class="none"></span>commons-beanutils</a></li>
    <li><a href="issues.html" title="Known Issues"><span class="none"></span>Known Issues</a></li>
    <li><a href="references.html" title="Reference Documentation"><span class="none"></span>Reference Documentation</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section>
<h1>File Store Access</h1>
<p>The file store access through SFTP is now configurable, allowing the user to
pick a supporting library to upload and delete files in the file store.</p><section>
<h2>History</h2>
<p>The original version of the Clarity Client used <em>spring-integration-sftp</em> directly
in the client to access the file store. This at the time used
<a href="http://www.jcraft.com/jsch" class="externalLink">JCraft's <code>JSch</code></a> library to do the low level SSH
communication. The update for this second version of the Clarity Client moved the
dependency on to Spring Integrations 6.3 and with it a change from <code>JSch</code> under
the hood to <a href="https://mina.apache.org/sshd-project" class="externalLink">Apache Mina SSHD</a>. This
should have been almost invisible, hiding the detail behind the Spring wrapper of
<a href="https://docs.spring.io/spring-integration/api/org/springframework/integration/sftp/session/DefaultSftpSessionFactory.html" class="externalLink">DefaultSftpSessionFactory</a>.</p>
<p>All so far so good: there were some changes to the dependencies but it should work.
Except of course it didn't. We found Apache Mina to behave very strangely, timing
out accessing a server where we knew that the SSH daemon was running and we had the
correct credentials. Indeed, the command line <em>sftp</em> program worked as did the same
test in JSch.</p>
<p>To this end, the SFTP access to the file store has been abstracted away from the
client's code and put into classes that implement the new
<a href="apidocs/org.cruk.clarity.api/org/cruk/clarity/api/sftp/ClaritySFTPUploader.html"><code>ClaritySFTPUploader</code></a>
interface. Implementations are provided for Apache Mina and for JSch.</p>
<p>It is recommended to use Apache Mina SSHD if you can, as it is up to date whereas
JSch is very old now. If you have time out problems with Mina SSHD but the server
is accessible by other tools, then try switching to the JSch implementation.</p></section><section>
<h2>Picking an Implementation</h2><section>
<h3>Apache Mina</h3>
<p>Add the <em>clarity-client2-sftp-mina</em> artefact to your project.</p>

<div class="verbatim">
<pre><code class="language-XML">&lt;dependency&gt;
    &lt;groupId&gt;org.cruk.clarity&lt;/groupId&gt;
    &lt;artifactId&gt;clarity-client2-filestore-mina&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre></div>
<p>This artefact will bring in the dependencies <code>org.apache.sshd:sshd-osgi</code>
and <code>org.apache.sshd:sshd-sftp</code>.</p></section><section>
<h3>JCraft JSch</h3>
<p>Add the <em>clarity-client2-sftp-jsch</em> artefact to your project.</p>

<div class="verbatim">
<pre><code class="language-XML">&lt;dependency&gt;
    &lt;groupId&gt;org.cruk.clarity&lt;/groupId&gt;
    &lt;artifactId&gt;clarity-client2-filestore-jsch&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre></div>
<p>This artefact will bring in the dependency <code>com.jcraft:jsch</code>.</p></section><section>
<h3>No Implementation</h3>
<p>It should be noted that the client should work for uploading and downloading
files to and from the file store without SFTP access, instead sending uploads
through the Clarity API's file upload mechanism. There are however some
advantages of SFTP access:</p>
<ol style="list-style-type: decimal">

<li>The uploads can take place after a process has been completed. The HTTP
mechanism won't let files be uploaded to completed processes.</li>
<li>Files can be deleted from the file store. There isn't a mechanism for doing
this through HTTP (to my knowledge).</li>
</ol>
<p>If your code does not to upload files to or delete files from the file store,
it would be sensible not to include either SFTP file store implementation.</p></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2013–2024
<a href="https://www.cruk.cam.ac.uk/">Cancer Research UK Cambridge Institute</a>
</p>
        </div>
      </div>
    </footer>
<script>
  if(anchors) {
    anchors.add();
  }
</script>
  </body>
</html>
